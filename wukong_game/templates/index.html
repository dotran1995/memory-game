<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Myth Wukong</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #878b89;
            text-align: center;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
            margin: 0 auto;
            background-color: #6108f0;
        }
        #message {
            margin-top: 20px;
            font-size: 24px;
            color: #ff0022;
        }
    </style>
</head>
<body>
    <h1>Black Myth Wukong - Free - No Charge</h1>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <div id="message">Press Space to Start</div>

    <!-- Audio Element -->
    <audio id="backgroundMusic" loop>
        <source src="{{ url_for('static', filename='music/background_music.mp3') }}" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        // Constants
        const GRAVITY = 0.8;
        const JUMP_STRENGTH = -15;
        const OBSTACLE_SPEED = 5;
        const CANVAS_WIDTH = 800;
        const CANVAS_HEIGHT = 400;
    
        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
    
        // Load Images
        const backgroundImage = new Image();
        backgroundImage.src = "{{ url_for('static', filename='images/background.jpeg') }}";
    
        const monkeyImage = new Image();
        monkeyImage.src = "{{ url_for('static', filename='images/monkey.jpg') }}";
    
        const obstacleImages = [
            "{{ url_for('static', filename='images/obstacle1.png') }}",
            "{{ url_for('static', filename='images/obstacle2.png') }}",
            "{{ url_for('static', filename='images/obstacle3.png') }}"
        ];
    
        const groundImages = [
            "{{ url_for('static', filename='images/ground1.png') }}",
            "{{ url_for('static', filename='images/ground2.png') }}"
        ];
    
        // Function to pick a random image from an array
        function getRandomImage(images) {
            const image = new Image();
            image.src = images[Math.floor(Math.random() * images.length)];
            return image;
        }
    
        // Game objects
        let mario = {
            x: 50,
            y: 300,
            width: 40,
            height: 50,
            dy: 0,
            onGround: false,
            score: 0,
            image: monkeyImage
        };
    
        let ground = {
            x: 0,
            y: 350,
            width: CANVAS_WIDTH,
            height: 50,
            image: getRandomImage(groundImages)
        };
    
        let obstacle = {
            x: CANVAS_WIDTH,
            y: 300,
            width: 40,
            height: 50,
            image: getRandomImage(obstacleImages)
        };
    
        // Music setup
        const backgroundMusic = document.getElementById('backgroundMusic');
    
        // Drawing functions
        function drawBackground() {
            ctx.drawImage(backgroundImage, 0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        }
    
        function drawMario() {
            ctx.drawImage(mario.image, mario.x, mario.y, mario.width, mario.height);
        }
    
        function drawGround() {
            if (ground.image.complete) {
                ctx.drawImage(ground.image, ground.x, ground.y, ground.width, ground.height);
            }
        }
    
        function drawObstacle() {
            if (obstacle.image.complete) {
                ctx.drawImage(obstacle.image, obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            }
        }
    
        function drawScore() {
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText("Score: " + mario.score, 10, 20);
        }
    
        // Update functions
        function updateMario() {
            mario.y += mario.dy;
            mario.dy += GRAVITY;
    
            if (mario.y + mario.height >= ground.y) {
                mario.y = ground.y - mario.height;
                mario.onGround = true;
                mario.dy = 0;
            } else {
                mario.onGround = false;
            }
        }
    
        function updateObstacle() {
            obstacle.x -= OBSTACLE_SPEED;
    
            if (obstacle.x + obstacle.width < 0) {
                obstacle.x = CANVAS_WIDTH;
                obstacle.image = getRandomImage(obstacleImages);
                mario.score++;
            }
    
            // Collision detection
            if (mario.x < obstacle.x + obstacle.width &&
                mario.x + mario.width > obstacle.x &&
                mario.y < obstacle.y + obstacle.height &&
                mario.y + mario.height > obstacle.y) {
                gameOver();
            }
        }
    
        // Game over function
        function gameOver() {
            document.getElementById('message').textContent = "Dead Wukong!";
            clearInterval(gameLoopInterval);
            backgroundMusic.pause();
        }
    
        // Jump function
        function jump() {
            if (mario.onGround) {
                mario.dy = JUMP_STRENGTH;
            }
        }
    
        // Main game loop
        function gameLoop() {
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
    
            drawBackground();
            drawGround();
            drawMario();
            drawObstacle();
            drawScore();
    
            updateMario();
            updateObstacle();
        }
    
        // Event listener for starting the game
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space') {
                backgroundMusic.play().catch(error => {
                    console.error("Music playback failed:", error);
                });
                jump();
                if (!gameLoopInterval) {
                    gameLoopInterval = setInterval(gameLoop, 20);
                }
            }
        });
    
        // Start the game loop
        let gameLoopInterval = null;
    </script>
    
</body>
</html>
